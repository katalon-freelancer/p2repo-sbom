# CVE Data Sources - Quick Reference

This document provides a quick reference for vulnerability data sources that can be queried by API.

## Recommended for Implementation

### 1. OSV (Open Source Vulnerabilities) ⭐ BEST CHOICE

**Website**: https://osv.dev/  
**API Endpoint**: https://api.osv.dev/v1/query

**Query by Maven Package**:
```bash
curl -X POST https://api.osv.dev/v1/query \
  -H "Content-Type: application/json" \
  -d '{
    "package": {
      "name": "log4j-core",
      "ecosystem": "Maven"
    },
    "version": "2.14.0"
  }'
```

**Query by Hash**:
```bash
curl -X POST https://api.osv.dev/v1/query \
  -H "Content-Type: application/json" \
  -d '{
    "commit": "6c35f8e223efc935dbffb9e9e17e6231f8f0d69d"
  }'
```

**Why OSV?**
- ✅ Free and open-source
- ✅ No authentication required
- ✅ Direct Maven support
- ✅ Hash-based lookups
- ✅ Well-documented API
- ✅ Good rate limits
- ✅ Active maintenance by Google

### 2. Sonatype OSS Index

**Website**: https://ossindex.sonatype.org/  
**API Endpoint**: https://ossindex.sonatype.org/api/v3/component-report

**Query by PURL**:
```bash
curl -X POST https://ossindex.sonatype.org/api/v3/component-report \
  -H "Content-Type: application/json" \
  -d '{
    "coordinates": [
      "pkg:maven/org.apache.logging.log4j/log4j-core@2.14.0"
    ]
  }'
```

**Why OSS Index?**
- ✅ Direct PURL support (perfect match)
- ✅ Maven-specific
- ✅ Free tier available
- ❌ Lower rate limits (16 req/hour without auth)

### 3. deps.dev (Google)

**Website**: https://deps.dev/  
**API Endpoint**: https://api.deps.dev/v3alpha

**Query by Package**:
```bash
curl https://api.deps.dev/v3alpha/systems/maven/packages/org.apache.logging.log4j:log4j-core/versions/2.14.0
```

**Why deps.dev?**
- ✅ Free Google service
- ✅ Maven coordinate support
- ✅ Includes advisory information
- ✅ Good rate limits

## Other Options

### 4. GitHub Advisory Database

**API**: GitHub GraphQL API  
**Requires**: GitHub token

**GraphQL Query**:
```graphql
query {
  securityVulnerabilities(
    ecosystem: MAVEN, 
    package: "org.apache.logging.log4j:log4j-core", 
    first: 100
  ) {
    nodes {
      advisory {
        ghsaId
        summary
        severity
        publishedAt
      }
      vulnerableVersionRange
    }
  }
}
```

### 5. National Vulnerability Database (NVD)

**API**: https://services.nvd.nist.gov/rest/json/cves/2.0  
**Requires**: API key for higher rate limits

**Limitations**: No direct Maven coordinate lookup

### 6. Snyk Vulnerability Database

**API**: https://snyk.io/api/  
**Requires**: API token (free tier available)

## Comparison Table

| Source | Auth Required | Maven Support | Hash Support | Rate Limits | Best For |
|--------|---------------|---------------|--------------|-------------|----------|
| OSV | No | ✅ | ✅ | Good | First implementation |
| OSS Index | Optional | ✅ (PURL) | ❌ | Low (free) | PURL-based lookup |
| deps.dev | No | ✅ | ❌ | Good | Maven packages |
| GitHub | Yes (token) | ✅ | ❌ | Medium | GitHub projects |
| NVD | Optional | ❌ | ❌ | Low | General CVE info |
| Snyk | Yes | ✅ | ❌ | Varies | Commercial use |

## Implementation Priority

**Phase 1**: OSV
- Start with OSV for Maven packages
- Implement hash-based fallback for non-Maven components

**Phase 2**: Add OSS Index
- Use for components with PURL already set
- Provides redundancy

**Phase 3**: Add deps.dev
- Additional data source for Maven packages
- Cross-validation of results

## Example Response Format

### OSV Response Example
```json
{
  "vulns": [
    {
      "id": "GHSA-jfh8-c2jp-5v3q",
      "summary": "Apache Log4j2 JNDI features do not protect against attacker controlled LDAP and other JNDI related endpoints",
      "details": "...",
      "aliases": ["CVE-2021-44228"],
      "modified": "2023-11-07T05:04:53.985519Z",
      "published": "2021-12-10T20:33:38Z",
      "references": [
        {
          "type": "ADVISORY",
          "url": "https://nvd.nist.gov/vuln/detail/CVE-2021-44228"
        }
      ],
      "affected": [
        {
          "package": {
            "ecosystem": "Maven",
            "name": "org.apache.logging.log4j:log4j-core"
          },
          "ranges": [
            {
              "type": "ECOSYSTEM",
              "events": [
                {"introduced": "2.0.0"},
                {"fixed": "2.15.0"}
              ]
            }
          ]
        }
      ],
      "severity": [
        {
          "type": "CVSS_V3",
          "score": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H"
        }
      ],
      "database_specific": {
        "severity": "CRITICAL"
      }
    }
  ]
}
```

## Integration Notes

1. **Caching**: Implement local caching to avoid repeated API calls
2. **Batch Processing**: Where supported, batch multiple package queries
3. **Error Handling**: Continue SBOM generation even if vulnerability lookup fails
4. **Rate Limiting**: Implement exponential backoff for rate limit errors
5. **Configuration**: Make vulnerability queries optional (command-line flag)
6. **Timeout**: Set reasonable timeouts for API calls
7. **Deduplication**: When using multiple sources, deduplicate by CVE ID

## Code Example

```java
// Example integration point in createMavenJarComponent
private Component createMavenJarComponent(String path, MavenDescriptor mavenDescriptor, byte[] bytes) {
    var component = new Component();
    component.setType(Component.Type.LIBRARY);
    if (setMavenPurl(component, mavenDescriptor, bytes)) {
        component.setName(mavenDescriptor.artifactId());
        component.setGroup(mavenDescriptor.groupId());
    } else {
        component.setName(path);
    }
    
    // Query vulnerabilities if enabled
    if (queryVulnerabilities) {
        try {
            var vulns = vulnerabilityQuerier.queryByMaven(
                mavenDescriptor.groupId(),
                mavenDescriptor.artifactId(),
                mavenDescriptor.version()
            );
            for (var vuln : vulns) {
                component.addVulnerability(vuln);
            }
        } catch (Exception e) {
            // Log but don't fail
            System.err.println("Failed to query vulnerabilities: " + e.getMessage());
        }
    }
    
    return component;
}
```

## Resources

- CycloneDX Vulnerability Specification: https://cyclonedx.org/docs/1.6/json/#vulnerabilities
- OSV Schema: https://ossf.github.io/osv-schema/
- CVSS Calculator: https://www.first.org/cvss/calculator/3.1
